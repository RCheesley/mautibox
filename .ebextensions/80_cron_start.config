# Cron task configuration required for this project.
container_commands:
  80_webapp_home:
    command: mkdir -p /home/webapp
  81_webapp_permission:
    command: chown -R webapp:webapp /home/webapp
  82_remove_previous_cron_webapp:
    command: crontab -u webapp -r || exit 0
  83_remove_previous_cron_root:
    command: crontab -u root -r || exit 0
  84_remove_previous_cron_backups:
    command: rm -f /etc/cron.d/*.bak

files:
  "/etc/cron.d/z_mautic":
    mode: "000644"
    owner: root
    group: root
    content: |
      # The cron alias facilitates correct permissions and runs these tasks on all active pull requests.
      # See documentation for these cron jobs at https://mautic.org/docs/en/setup/cron_jobs.html

      # SEGMENTS
      0,20,40 * * * * root cron mautic:segments:update

      # CAMPAIGNS
      2,22,42 * * * * root cron mautic:campaigns:rebuild
      4,24,44 * * * * root cron mautic:campaigns:trigger
      6,26,46 * * * * root cron mautic:messages:send

      # EMAIL
      8,28,48 * * * * root cron mautic:emails:send
      10,30,50 * * * * root cron mautic:email:fetch
      12,32,52 * * * * root cron mautic:broadcasts:send

      # SOCIAL
      14,34,54 * * * * root cron mautic:social:monitoring

      # WEBHOOKS
      16,36,56 * * * * root cron mautic:webhooks:process

      # IMPORTS
      18,38,58 * * * * root cron mautic:import

  "/etc/cron.d/z_mautibox":
    mode: "000644"
    owner: root
    group: root
    content: |
      # This acts as a worker daemon, running the build script as root.
      * * * * * root bash /var/app/current/scripts/queue.sh

      # Keep the pull request list fresh.
      * * * * * root curl -I https://mautibox.com/api/pulls/

      # Keep stage up to date.
      * * * * * root bash /var/app/current/scripts/stage.sh
